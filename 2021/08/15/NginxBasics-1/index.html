<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Nginx 基础 - PowerfooI</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Somewhere - Zone of PowerfooI"><meta name="msapplication-TileImage" content="/img/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Somewhere - Zone of PowerfooI"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon.png"><meta name="description" content="背景Nginx 读作 engine x，是一个高性能的 HTTP 和反向代理服务器，还能用作邮件代理服务器或是通用的 TCP&amp;#x2F;UDP 代理服务器。有过后端程序部署经历的同学应该会有所了解，用 Nginx 能够很方便地完成反向代理、服务静态文件、实现负载均衡、接入HTTPS协议等任务。 根据官方文档里面写到的，除了提供静态文件服务、反向代理和负载均衡等功能之外，还提供以下包括单不限于若干个方面的支持"><meta property="og:type" content="blog"><meta property="og:title" content="Nginx 基础"><meta property="og:url" content="https://powerfooi.github.io/2021/08/15/NginxBasics-1/"><meta property="og:site_name" content="PowerfooI"><meta property="og:description" content="背景Nginx 读作 engine x，是一个高性能的 HTTP 和反向代理服务器，还能用作邮件代理服务器或是通用的 TCP&amp;#x2F;UDP 代理服务器。有过后端程序部署经历的同学应该会有所了解，用 Nginx 能够很方便地完成反向代理、服务静态文件、实现负载均衡、接入HTTPS协议等任务。 根据官方文档里面写到的，除了提供静态文件服务、反向代理和负载均衡等功能之外，还提供以下包括单不限于若干个方面的支持"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://powerfooi.github.io/img/og_image.png"><meta property="article:published_time" content="2021-08-15T07:35:11.000Z"><meta property="article:modified_time" content="2022-01-11T17:17:11.850Z"><meta property="article:author" content="PowerfooI"><meta property="article:tag" content="部署"><meta property="article:tag" content="Nginx"><meta property="article:tag" content="文档阅读"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://powerfooi.github.io/2021/08/15/NginxBasics-1/"},"headline":"Nginx 基础","image":["https://powerfooi.github.io/img/og_image.png"],"datePublished":"2021-08-15T07:35:11.000Z","dateModified":"2022-01-11T17:17:11.850Z","author":{"@type":"Person","name":"PowerfooI"},"publisher":{"@type":"Organization","name":"PowerfooI","logo":{"@type":"ImageObject","url":{"text":"Somewhere - Zone of PowerfooI"}}},"description":"背景Nginx 读作 engine x，是一个高性能的 HTTP 和反向代理服务器，还能用作邮件代理服务器或是通用的 TCP&#x2F;UDP 代理服务器。有过后端程序部署经历的同学应该会有所了解，用 Nginx 能够很方便地完成反向代理、服务静态文件、实现负载均衡、接入HTTPS协议等任务。 根据官方文档里面写到的，除了提供静态文件服务、反向代理和负载均衡等功能之外，还提供以下包括单不限于若干个方面的支持"}</script><link rel="canonical" href="https://powerfooi.github.io/2021/08/15/NginxBasics-1/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Somewhere - Zone of PowerfooI</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/PowerfooI"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-15T07:35:11.000Z" title="8/15/2021, 3:35:11 PM">2021-08-15</time></span><span class="level-item"><a class="link-muted" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></span><span class="level-item">13 minutes read (About 1993 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Nginx 基础</h1><div class="content"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>Nginx 读作 <code>engine x</code>，是一个高性能的 HTTP 和反向代理服务器，还能用作邮件代理服务器或是通用的 TCP/UDP 代理服务器。有过后端程序部署经历的同学应该会有所了解，用 Nginx 能够很方便地完成反向代理、服务静态文件、实现负载均衡、接入HTTPS协议等任务。</p>
<p>根据官方文档里面写到的，除了提供静态文件服务、反向代理和负载均衡等功能之外，还提供以下包括单不限于若干个方面的支持：</p>
<ol>
<li>FastCGI, uwsgi 之类服务器和反向代理服务器的缓存支持；</li>
<li>以域名/IP为基础的虚拟服务器、Keep-alive 和流水线链接的支持；</li>
<li>访问日志、错误日志的输出和格式化，带缓存的日志写机制；</li>
<li>3xx-5xx 错误码重定向，根据正则表达式重写URI (Rewrite)；</li>
<li>基于客户端地址的访问控制和函数调用；</li>
<li>HTTP referer 的验证、支持除了 GET 外的几种 HTTP 方法： PUT/DELETE/COPY/MOVE/MKCOL；</li>
<li>FLV/MP4 的流播放、响应限流、限制单点的并发连接数和请求数；</li>
<li>等等…（上面只列了我读得懂的）</li>
</ol>
<p>Nginx 的功能实在太多了，在这里全部列出来不太可能。一直以来我对 Nginx 都停留在“配置是什么，work 就行”的态度。因为这周程序部署时遇到的一点问题，上网搜了好多帖子、博客寻求解决方法那种捉襟见肘、有病乱投医的样子让我觉得很狼狈。借此为契机，决定周末看一下 Nginx 的官方文档。nginx 旧版的官网文档组织混乱，建议移步 <a target="_blank" rel="noopener" href="https://docs.nginx.com/">Nginx Plus (Nginx 的商业版)官网</a>。Nginx 和 Nginx Plus 的对比<a target="_blank" rel="noopener" href="https://www.nginx.com/products/nginx/compare-models">放在这里</a>。</p>
<span id="more"></span>
<h2 id="基本功能概况"><a href="#基本功能概况" class="headerlink" title="基本功能概况"></a>基本功能概况</h2><h3 id="Name-IP-based-Virtual-servers"><a href="#Name-IP-based-Virtual-servers" class="headerlink" title="Name/IP-based Virtual servers"></a>Name/IP-based Virtual servers</h3><p>Nginx 接收到请求之后会首先决定让哪个 server 来接受这个请求。在 nginx 的配置文件中使用 <code>server</code> 这个指令可以定义“服务器”区域，当然最后到底是谁处理这个请求也是看 server 是如何定义的。下面是示例代码块：</p>
<figure class="highlight bash"><figcaption><span>demo.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name example.org www.example.org;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name example.net www.example.net;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name example.com www.example.com;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个配置文件定义了 3 个服务器，都监听了 *:80 端口。Nginx 接收到请求之后会转发给 <code>server_name</code> 字段与请求头中的 <code>Host</code> 字段相同的 server 进行处理。如果没有完全对应的 Server 那么请求会被转发到默认服务器进行处理。<code>default_server</code> 是 <code>listen</code> 指令的可选参数，如果在端口号后加上 <code>default_server</code> 表示这个服务器是默认服务器。<strong>如果没有任何 server 有 <code>default_server</code>，那配置文件中定义的第一个 server 就是默认的服务器</strong>。</p>
<p>对 <code>listen</code> 中的 IP 地址进行配置也是可行的。下面再看一个配置文件：</p>
<figure class="highlight bash"><figcaption><span>demo2.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      192.168.1.1:80;</span><br><span class="line">    server_name example.org www.example.org;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      192.168.1.1:80;</span><br><span class="line">    server_name example.net www.example.net;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      192.168.1.2:80;</span><br><span class="line">    server_name example.com www.example.com;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个配置文件下，Nginx 会先判断请求的 IP，再判断 <code>server_name</code> 字段。</p>
<h3 id="Locations"><a href="#Locations" class="headerlink" title="Locations"></a>Locations</h3><h4 id="路径配置规则"><a href="#路径配置规则" class="headerlink" title="路径配置规则"></a>路径配置规则</h4><p>在 <code>server</code> 区域之中，可以定义若干个 <code>location</code> 区域。<code>location</code> 指令可以根据请求的 URI 将请求分发到不同的代理或者不同的静态文件目录中，后面提到的所有 <code>location</code> 配置都在 <code>server</code> 区域之中。</p>
<p><code>location prefix</code> 匹配符合 <code>prefix</code> 前缀的 URI，如果一个请求的 URI 匹配了很多 location 的 prefix 那么请求会被分发到 prefix 定义最长的 location 块中。另外，<code>location</code> 指令还可以有标识符配置：</p>
<ol>
<li><code>location = path</code> 表示 URI 需要准确的等于 path 才会落到这个 location 区域进行处理；</li>
<li><code>location ~ regex</code> 表示 URI 匹配相应的正则表达式。如果是 <code>~*</code> 的话，是忽略大小写的；</li>
<li><code>location ^~ prefix</code> 表示这个 prefix 匹配的话，不考虑相应的正则表达式；</li>
</ol>
<h4 id="匹配优先级"><a href="#匹配优先级" class="headerlink" title="匹配优先级"></a>匹配优先级</h4><p>要找到最好的 <code>location</code> 块来匹配一个 URI，Nginx 会先匹配所有的 prefix，然后再匹配所有的正则表达式。但是 Nginx 会给正则表达式更高的优先级，除非有 <code>^~</code> 标识符。准确的匹配流程如下：</p>
<ol>
<li>将 URI 与所有的 prefix 进行比对；</li>
<li>如果 <code>=</code> 标识符的 location 命中了，直接使用该 location 进行处理，匹配过程终止；</li>
<li>如果有 <code>^~</code> 标识符标识某个 prefix，则后续不用正则表达式检测这个 prefix 命中的 URI；</li>
<li>保存最长的匹配的 prefix；</li>
<li>将 URI 与所有的正则表达式进行比对；</li>
<li>如果 URI 匹配到某个正则表达式，立即停止比对，用这个正则表达式对应的 location 进行处理；</li>
<li>如果没有正则表达式匹配，用第 4 步保存的最长的 prefix 来处理。</li>
</ol>
<p>那么根据这个流程，在配置 <code>/</code> 对应的处理方式时，使用 <code>=</code> 标识符能够提高 Nginx 的响应速度。</p>
<h4 id="root-index-proxy-pass"><a href="#root-index-proxy-pass" class="headerlink" title="root, index, proxy_pass"></a>root, index, proxy_pass</h4><p><code>root</code>, <code>index</code>, <code>proxy_pass</code> 是几个在 <code>location</code> 区域内常用的指令，这里专门查一下它们的用法。</p>
<ul>
<li><code>root path</code> 用文件系统路径来表示，表示在这个 location 中从哪个目录找静态文件来服务；</li>
<li><code>index file ...</code> 定义首页文件，按照给定顺序注意匹配，最后一个文件名可以是绝对路径；</li>
<li><code>proxy_pass url</code> 将请求转发到某个代理服务器上。</li>
</ul>
<h3 id="变量和改写"><a href="#变量和改写" class="headerlink" title="变量和改写"></a>变量和改写</h3><h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><p>在 Nginx 的配置文件中可以使用以 <code>$</code> 开头的变量，和 linux 的 shell 变量相似。Nginx 预定义了很多变量如 <code>$remote_addr</code> 表示客户端的 IP 地址，<code>$uri</code> 表示目前 URI 的值。用户也可以使用 <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_rewrite_module.html#set">set</a> 和 <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_map_module.html#map">map</a> 这两个指令在配置文件中自定义变量。</p>
<p>Nginx 内置的变量列表在这里可以查看：<a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_core_module.html#variables">core HTTP</a></p>
<h4 id="改写"><a href="#改写" class="headerlink" title="改写"></a>改写</h4><p><strong>return</strong> 使用 <code>return code [url/&quot;string&quot;]</code> 可以给请求返回相应的状态码，或者直接以 <code>30x</code> 的状态码跳转到后续的 <code>url</code>，以 <code>200</code> 的状态码返回一个 string。</p>
<figure class="highlight bash"><figcaption><span>demoReturn.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location /wrong/url &#123;</span><br><span class="line">    <span class="built_in">return</span> 404;</span><br><span class="line">&#125;</span><br><span class="line">location /permanently/moved/url &#123;</span><br><span class="line">    <span class="built_in">return</span> 301 http://www.example.com/moved/here;</span><br><span class="line">&#125;</span><br><span class="line">location /text/url &#123;</span><br><span class="line">    <span class="built_in">return</span> 200 <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>rewrite</strong> 使用 <code>rewrite regex target cmd</code> 可以将 regex 匹配的路径改写到 target，cmd 这个参数有 <code>break</code> 和 <code>last</code> 这两个最常用的。它们俩的区别有两点：</p>
<ul>
<li><code>last</code> 会终止在当前 server 或者 location 区域当中的 rewrite 执行，但是重写到 target 之后落在新的 location 中的 rewrite（如果有的话）还是会继续执行；</li>
<li><code>break</code> 终止当前背景下的 rewrite 执行之外，新的 location 中的 rewrite 也不会执行。</li>
</ul>
<p>rewrite 的例子可以看下面的配置：</p>
<figure class="highlight bash"><figcaption><span>demoRewrite.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location /users/ &#123;</span><br><span class="line">    rewrite ^/users/(.*)$ /show?user=<span class="variable">$1</span> <span class="built_in">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    rewrite ^(/download/.*)/media/(\w+)\.?.*$ <span class="variable">$1</span>/mp3/<span class="variable">$2</span>.mp3 last;</span><br><span class="line">    rewrite ^(/download/.*)/audio/(\w+)\.?.*$ <span class="variable">$1</span>/mp3/<span class="variable">$2</span>.ra  last;</span><br><span class="line">    <span class="built_in">return</span>  403;</span><br><span class="line">    <span class="comment"># 可以组合使用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这次走马观花看了一篇最基础的教程有了较多的新认识，服务静态文件、反向代理、压缩和解压缩、内容缓存等等内容在 Nginx Plus 的文档中都有比较系统的讲解，之后有需要或者有时间的时候再看看吧。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Nginx 基础</p><p><a href="https://powerfooi.github.io/2021/08/15/NginxBasics-1/">https://powerfooi.github.io/2021/08/15/NginxBasics-1/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>PowerfooI</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-08-15</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-01-12</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E9%83%A8%E7%BD%B2/">部署</a><a class="link-muted mr-2" rel="tag" href="/tags/Nginx/">Nginx</a><a class="link-muted mr-2" rel="tag" href="/tags/%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB/">文档阅读</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/01/15/SomethingFor2022/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">2022年我希望...</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/07/23/UseGraphQLElegantly/"><span class="level-item">如何相对优雅地使用 GraphQL</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://powerfooi.github.io/2021/08/15/NginxBasics-1/';
            this.page.identifier = '2021/08/15/NginxBasics-1/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'cactus-1' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/logo.png" alt="PowerfooI"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">PowerfooI</p><p class="is-size-6 is-block">研究生在读</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>北京</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">18</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">16</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/PowerfooI" target="_blank" rel="noopener">Follow</a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">学习</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%B8%B8%E8%AE%B0/"><span class="level-start"><span class="level-item">游记</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%9A%8F%E7%AC%94/"><span class="level-start"><span class="level-item">随笔</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/CI-CD/"><span class="tag">CI/CD</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Github/"><span class="tag">Github</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GraphQL/"><span class="tag">GraphQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Misc/"><span class="tag">Misc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NPM/"><span class="tag">NPM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/React/"><span class="tag">React</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vue/"><span class="tag">Vue</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/"><span class="tag">前端开发</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"><span class="tag">小程序</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%91%84%E5%BD%B1/"><span class="tag">摄影</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB/"><span class="tag">文档阅读</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%85%E6%B8%B8/"><span class="tag">旅游</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%83%A1%E6%80%9D%E4%B9%B1%E6%83%B3/"><span class="tag">胡思乱想</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"><span class="tag">论文阅读</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%83%A8%E7%BD%B2/"><span class="tag">部署</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#背景"><span class="level-left"><span class="level-item">1</span><span class="level-item">背景</span></span></a></li><li><a class="level is-mobile" href="#基本功能概况"><span class="level-left"><span class="level-item">2</span><span class="level-item">基本功能概况</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Name-IP-based-Virtual-servers"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Name/IP-based Virtual servers</span></span></a></li><li><a class="level is-mobile" href="#Locations"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Locations</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#路径配置规则"><span class="level-left"><span class="level-item">2.2.1</span><span class="level-item">路径配置规则</span></span></a></li><li><a class="level is-mobile" href="#匹配优先级"><span class="level-left"><span class="level-item">2.2.2</span><span class="level-item">匹配优先级</span></span></a></li><li><a class="level is-mobile" href="#root-index-proxy-pass"><span class="level-left"><span class="level-item">2.2.3</span><span class="level-item">root, index, proxy_pass</span></span></a></li></ul></li><li><a class="level is-mobile" href="#变量和改写"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">变量和改写</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#变量"><span class="level-left"><span class="level-item">2.3.1</span><span class="level-item">变量</span></span></a></li><li><a class="level is-mobile" href="#改写"><span class="level-left"><span class="level-item">2.3.2</span><span class="level-item">改写</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#总结"><span class="level-left"><span class="level-item">3</span><span class="level-item">总结</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-03-12T09:24:00.000Z">2022-03-12</time></p><p class="title"><a href="/2022/03/12/PublishNpmPackageOfReactComponents/">打包发布 React 组件库</a></p><p class="categories"><a href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-15T04:08:09.000Z">2022-01-15</time></p><p class="title"><a href="/2022/01/15/SomethingFor2022/">2022年我希望...</a></p><p class="categories"><a href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-15T07:35:11.000Z">2021-08-15</time></p><p class="title"><a href="/2021/08/15/NginxBasics-1/">Nginx 基础</a></p><p class="categories"><a href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-23T05:38:11.000Z">2021-07-23</time></p><p class="title"><a href="/2021/07/23/UseGraphQLElegantly/">如何相对优雅地使用 GraphQL</a></p><p class="categories"><a href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-20T13:24:40.000Z">2021-07-20</time></p><p class="title"><a href="/2021/07/20/TheThirdMiniprogramCompetition/">记2021年小程序大赛</a></p><p class="categories"><a href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></p></div></article></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Somewhere - Zone of PowerfooI</a><p class="is-size-7"><span>&copy; 2022 PowerfooI</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>