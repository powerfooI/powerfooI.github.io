<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Controller-runtime æºç é˜…è¯» - PowerfooI çš„ä¸ªäººåšå®¢</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Somewhere - PowerfooI&#039;s Zone"><meta name="msapplication-TileImage" content="/img/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Somewhere - PowerfooI&#039;s Zone"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon.png"><meta name="description" content="Operator æ˜¯ Kubernetes ç”¨æ¥æ‹“å±•å…¶ API çš„ä¸€ç§å¼€å‘èŒƒå¼ï¼ˆPatternï¼‰ï¼Œå…¶æ ¸å¿ƒæ˜¯å®šä¹‰è‹¥å¹²çš„è‡ªå®šä¹‰èµ„æºåŠå…¶å¯¹åº”çš„èµ„æºæ§åˆ¶å™¨ï¼Œå½“è¿™äº›èµ„æºå‘ç”Ÿå˜åŒ–æ—¶å…¶å¯¹åº”çš„æ§åˆ¶å™¨å¯¹å˜åŒ–è¿›è¡Œè°ƒè§£ï¼ˆReconcileï¼‰ï¼Œæœ€ç»ˆä½¿å¾—å®é™…çŠ¶æ€ä¸é¢„æœŸçŠ¶æ€è¾¾æˆä¸€è‡´ã€‚K8s-sigs æ¨å‡ºçš„ kubebuilder æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Operator åº”ç”¨çš„æ¡†æ¶ï¼Œå’Œ Operator-SDK ä¸€æ ·éƒ½ä¾èµ–äº† co"><meta property="og:type" content="blog"><meta property="og:title" content="Controller-runtime æºç é˜…è¯»"><meta property="og:url" content="https://powerfooi.github.io/2024/02/03/ReadSourceOfControllerRuntime/"><meta property="og:site_name" content="PowerfooI çš„ä¸ªäººåšå®¢"><meta property="og:description" content="Operator æ˜¯ Kubernetes ç”¨æ¥æ‹“å±•å…¶ API çš„ä¸€ç§å¼€å‘èŒƒå¼ï¼ˆPatternï¼‰ï¼Œå…¶æ ¸å¿ƒæ˜¯å®šä¹‰è‹¥å¹²çš„è‡ªå®šä¹‰èµ„æºåŠå…¶å¯¹åº”çš„èµ„æºæ§åˆ¶å™¨ï¼Œå½“è¿™äº›èµ„æºå‘ç”Ÿå˜åŒ–æ—¶å…¶å¯¹åº”çš„æ§åˆ¶å™¨å¯¹å˜åŒ–è¿›è¡Œè°ƒè§£ï¼ˆReconcileï¼‰ï¼Œæœ€ç»ˆä½¿å¾—å®é™…çŠ¶æ€ä¸é¢„æœŸçŠ¶æ€è¾¾æˆä¸€è‡´ã€‚K8s-sigs æ¨å‡ºçš„ kubebuilder æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Operator åº”ç”¨çš„æ¡†æ¶ï¼Œå’Œ Operator-SDK ä¸€æ ·éƒ½ä¾èµ–äº† co"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://powerfooi.github.io/gallery/covers/Controller-runtime.png"><meta property="article:published_time" content="2024-02-03T13:56:52.000Z"><meta property="article:modified_time" content="2024-08-04T02:40:36.185Z"><meta property="article:author" content="PowerfooI"><meta property="article:tag" content="Reading"><meta property="article:tag" content="CloudNative"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://powerfooi.github.io/gallery/covers/Controller-runtime.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://powerfooi.github.io/2024/02/03/ReadSourceOfControllerRuntime/"},"headline":"Controller-runtime æºç é˜…è¯»","image":["https://powerfooi.github.io/gallery/covers/Controller-runtime.png"],"datePublished":"2024-02-03T13:56:52.000Z","dateModified":"2024-08-04T02:40:36.185Z","author":{"@type":"Person","name":"PowerfooI"},"publisher":{"@type":"Organization","name":"PowerfooI çš„ä¸ªäººåšå®¢","logo":{"@type":"ImageObject","url":{"text":"Somewhere - PowerfooI's Zone"}}},"description":"Operator æ˜¯ Kubernetes ç”¨æ¥æ‹“å±•å…¶ API çš„ä¸€ç§å¼€å‘èŒƒå¼ï¼ˆPatternï¼‰ï¼Œå…¶æ ¸å¿ƒæ˜¯å®šä¹‰è‹¥å¹²çš„è‡ªå®šä¹‰èµ„æºåŠå…¶å¯¹åº”çš„èµ„æºæ§åˆ¶å™¨ï¼Œå½“è¿™äº›èµ„æºå‘ç”Ÿå˜åŒ–æ—¶å…¶å¯¹åº”çš„æ§åˆ¶å™¨å¯¹å˜åŒ–è¿›è¡Œè°ƒè§£ï¼ˆReconcileï¼‰ï¼Œæœ€ç»ˆä½¿å¾—å®é™…çŠ¶æ€ä¸é¢„æœŸçŠ¶æ€è¾¾æˆä¸€è‡´ã€‚K8s-sigs æ¨å‡ºçš„ kubebuilder æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Operator åº”ç”¨çš„æ¡†æ¶ï¼Œå’Œ Operator-SDK ä¸€æ ·éƒ½ä¾èµ–äº† co"}</script><link rel="canonical" href="https://powerfooi.github.io/2024/02/03/ReadSourceOfControllerRuntime/"><link rel="alternate" href="/atom.xml" title="PowerfooI çš„ä¸ªäººåšå®¢" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script><!-- hexo-inject:begin --><!-- hexo-inject:end -->var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?371b1d983749aad213c30979122b6579";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-TNMDKQMTYG" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-TNMDKQMTYG');</script><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Somewhere - PowerfooI&#039;s Zone</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/PowerfooI"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="ç›®å½•" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/gallery/covers/Controller-runtime.png" alt="Controller-runtime æºç é˜…è¯»"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-02-03T13:56:52.000Z" title="2/3/2024, 9:56:52 PM">2024-02-03</time>å‘è¡¨</span><span class="level-item"><a class="link-muted" href="/categories/%E5%AD%A6%E4%B9%A0/">å­¦ä¹ </a></span><span class="level-item">29 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦4317ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile">Controller-runtime æºç é˜…è¯»</h1><div class="content"><p>Operator æ˜¯ Kubernetes ç”¨æ¥æ‹“å±•å…¶ API çš„ä¸€ç§å¼€å‘èŒƒå¼ï¼ˆPatternï¼‰ï¼Œå…¶æ ¸å¿ƒæ˜¯å®šä¹‰è‹¥å¹²çš„è‡ªå®šä¹‰èµ„æºåŠå…¶å¯¹åº”çš„èµ„æºæ§åˆ¶å™¨ï¼Œå½“è¿™äº›èµ„æºå‘ç”Ÿå˜åŒ–æ—¶å…¶å¯¹åº”çš„æ§åˆ¶å™¨å¯¹å˜åŒ–è¿›è¡Œè°ƒè§£ï¼ˆReconcileï¼‰ï¼Œæœ€ç»ˆä½¿å¾—å®é™…çŠ¶æ€ä¸é¢„æœŸçŠ¶æ€è¾¾æˆä¸€è‡´ã€‚K8s-sigs æ¨å‡ºçš„ <a href="https://book.kubebuilder.io/">kubebuilder</a> æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Operator åº”ç”¨çš„æ¡†æ¶ï¼Œå’Œ <a href="https://github.com/operator-framework/operator-sdk">Operator-SDK</a> ä¸€æ ·éƒ½ä¾èµ–äº† <a href="https://github.com/kubernetes-sigs/controller-runtime">controller-runtime</a>ï¼Œæä¾›äº†é«˜çº§ API å’ŒæŠ½è±¡ï¼Œè®©å¼€å‘è€…æ›´ç›´è§‚åœ°ç¼–å†™æ“ä½œé€»è¾‘ï¼Œå¹¶æä¾›ç”¨äºå¿«é€Ÿå¯åŠ¨æ–°é¡¹ç›®çš„è„šæ‰‹æ¶å’Œä»£ç ç”Ÿæˆå·¥å…·ã€‚</p>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><p>æˆªè‡³ç›®å‰æˆ‘å·²ç»å‚ä¸äº†ä¸¤ä¸ª Operator é¡¹ç›®çš„æ­å»ºå’Œç»´æŠ¤ï¼Œå‡é‡‡ç”¨äº† kubebuilder åšåŸºç¡€è„šæ‰‹æ¶ã€‚æˆ‘ç›®å‰å¯¹ CRD çš„è®¾è®¡ç”Ÿæˆã€Webhook çš„æ ¡éªŒæœºåˆ¶å’Œã€Controller çš„æ§åˆ¶å¾ªç¯æœºåˆ¶æœ‰äº†ä¸€å®šè®¤è¯†ï¼Œæ¥è§¦æ—¶é—´ç¨é•¿ååœ¨æ—¥å¸¸å¼€å‘ Operator é¡¹ç›®æ—¶éš¾å…å‡ºç°ç¼ºä¹æ–°æ„çš„æƒ…å†µï¼ŒOperator æ¨¡å¼çœ‹ä¹…äº†å’Œ CURD ä¹‹äºåç«¯æœ‰äº›è®¸ç›¸ä¼¼ã€‚ä½†æˆ‘ä¹è§‚åœ°ä¼°è®¡é€šè¿‡è§‚å¯Ÿä¸‹å±‚å®ç°å¯ä»¥æ”¶è·ä¸€äº›å¯å‘ã€‚æ—¢ç„¶ kubebuilder å’Œ Operator-SDK éƒ½ä¾èµ–äº† controller-runtimeï¼Œé‚£ä¹ˆå°±å…ˆä»å®ƒå‡ºå‘å§ã€‚</p>
<span id="more"></span>

<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><h2 id="MindMap"><a href="#MindMap" class="headerlink" title="MindMap"></a>MindMap</h2><p>controller-runtime è¿™ä¸ªåŒ…çš„å†…å®¹ä¸å°‘ï¼Œä¸ºäº†åœ¨ä¸€ç¯‡æ–‡ç« é‡Œèƒ½è¦†ç›–åˆ°ï¼Œæœ¬æ–‡ä»…é€‰å–åœ¨æ„å»º Operator è¿‡ç¨‹ä¸­èµ·å…³é”®ä½œç”¨çš„åŒ…è¿›è¡Œä»‹ç»ï¼Œ<code>envtest</code>ã€<code>scheme</code>ã€<code>certwatcher</code> ç­‰åŒæ ·é‡è¦çš„åŒ…å°±ä¸åœ¨æ­¤æåŠã€‚ä¸‹é¢æ˜¯æˆ‘è¯»ä»£ç æ—¶ç”»çš„æ„è¯†æµæ€ç»´å¯¼å›¾ï¼Œæœ‰çš„å­é¡¹ç›®æ˜¯ç»„æˆç»“æ„ï¼Œæœ‰çš„å­é¡¹ç›®æ˜¯å·¥ä½œè§’è‰²ï¼Œæ¯”è¾ƒè‡ªç”±çµæ´»ã€‚æˆ‘é€‰å–äº† <code>Cache</code>,<code>Source</code>, <code>Handler</code>, <code>Client</code>, <code>Controller</code> å’Œ <code>Manager</code> è¿™å…­ä¸ªåŒ…ã€‚</p>
<img src="/2024/02/03/ReadSourceOfControllerRuntime/Controller-runtime.png" class="" title="æ„è¯†æµçš„æ€ç»´å¯¼å›¾">

<h2 id="WorkFlow"><a href="#WorkFlow" class="headerlink" title="WorkFlow"></a>WorkFlow</h2><p>å¯¹äºæ§åˆ¶å™¨è€Œè¨€ï¼Œèµ„æºå‘ç”Ÿå˜åŠ¨çš„ä¿¡æ¯å‡æ¥è‡ªäº API Serverï¼Œä»èµ„æºå‘ç”Ÿå˜åŠ¨åˆ°æ§åˆ¶å™¨å®Œæˆè°ƒè§£éœ€è¦ç»è¿‡å¤šä¸ªæ¨¡å—çš„å¤„ç†ï¼Œå¤§ä½“æ¥è¯´å¯ä»¥ç”¨ä¸‹é¢çš„å›¾æ¥è¡¨ç¤ºã€‚</p>
<img src="/2024/02/03/ReadSourceOfControllerRuntime/Controller-workflow.png" class="" title="æ§åˆ¶å™¨å·¥ä½œæµç¨‹">

<h1 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h1><p>Cache åŒ…é€šè¿‡ Informers æ¥å£å°è£…äº† client-go ä¸­çš„ç¼“å­˜æœºåˆ¶ SharedInformerï¼Œä¸ºæ¯ä¸ªèµ„æºç±»å‹éƒ½åˆ›å»ºå¯¹åº”çš„ Informerï¼Œé€šè¿‡å®ƒä»¬çš„ç¼“å­˜é¿å…æ‰€æœ‰è¯·æ±‚éƒ½ç›´æ¥è®¿é—® API Server å¯¼è‡´å…¶å¯èƒ½çš„ä¸å ªé‡è´Ÿã€‚SharedInformer æœºåˆ¶åœ¨ client-go ä¸­å®šä¹‰ï¼Œå®ƒé‡‡ç”¨å¢é‡åŒæ­¥çš„æ–¹å¼ä» API Server å¤„â€œè®¢é˜…â€æŸç±»èµ„æºçš„äº‹ä»¶ï¼Œå¹¶ä¸”å°†äº‹ä»¶çš„å¢é‡æ›´æ–°ä¿å­˜åœ¨æœ¬åœ°å­˜å‚¨ï¼ˆStoreï¼‰å½“ä¸­ï¼Œå…¶ä¸­å…¸å‹çš„å­˜å‚¨æ˜¯ DeltaFIFOã€‚SharedInformer æ˜¯ k8s client-go ä¸­çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå‡ ä¹æ‰€æœ‰çš„å®¢æˆ·ç«¯åº”ç”¨éƒ½ç»•ä¸å¼€å®ƒï¼Œä¹‹åæœ‰ç©ºå†é˜…è¯»æŸ¥çœ‹å…¶ä¸­ç»†èŠ‚ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å†å±•å¼€ã€‚</p>
<p>æ§åˆ¶æµè·¯å¾„å¤§è‡´ä¸º cache.New -&gt; newCache -&gt; internal.NewInformers -&gt; sharedInformersï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li>cluster åˆå§‹åŒ–æ—¶é€šè¿‡ <code>cache.New</code> åˆ›å»ºé›†ç¾¤èµ„æºç¼“å­˜ï¼Œé»˜è®¤çš„åˆ›å»ºç¼“å­˜æ–¹æ³•å¯ä»¥é€šè¿‡ä¼ å…¥è‡ªå®šä¹‰çš„ç¼“å­˜åˆå§‹åŒ–å‡½æ•°è¿›è¡Œ Mockï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦ä¼ å…¥è‡ªå®šä¹‰çš„å‡½æ•°ï¼›</li>
<li>åœ¨ Cache çš„åˆå§‹åŒ–å‡½æ•°å½“ä¸­å¯ä»¥ä¸ºæ¯ä¸ªç±»å‹çš„èµ„æºå®šä¹‰ç»†ç²’åº¦çš„ç¼“å­˜ç­–ç•¥ï¼Œé€šè¿‡ <code>cache.Options</code> ä¸­çš„ <code>ByObject</code> å­—æ®µè¿›è¡Œé…ç½®ã€‚åœ¨ <code>manager.Options</code> ä¸­çš„ <code>Cache</code> å°±æ˜¯è´Ÿè´£æ§åˆ¶ç¼“å­˜çš„è¡Œä¸ºçš„å­—æ®µã€‚</li>
<li><code>internal.Informers</code> æä¾›äº† <code>Get</code>ã€<code>Peek</code> å’Œ <code>Remove</code> æ–¹æ³•ã€‚å…¶ä¸­ Get æ–¹æ³•ä¸­è°ƒç”¨ Peekï¼Œè‹¥æ²¡æœ‰è·å–åˆ°æŒ‡å®šçš„ sharedInformerï¼Œä¼šæ ¹æ®é…ç½®å‚æ•°ä¸­çš„ <code>newInformer</code> æ–¹æ³•åˆ›å»ºå‡ºæ¥å¹¶ä¸”æ·»åŠ åˆ° map å½“ä¸­ç•™ä½œåç”¨ï¼›Peek æ–¹æ³•è‹¥æ— æ³•ä» map ä¸­è·å–åˆ°ä¹Ÿä¸ä¼šè‡ªåŠ¨å¯åŠ¨æ–°çš„ sharedInformerã€‚</li>
<li>é€šè¿‡ <code>internal.Informers</code> è·å–åˆ° sharedInformerï¼Œåç»­çš„ Source åŒ…èƒ½å¤Ÿå°†äº‹ä»¶å¤„ç†å™¨ä¸å…¶ç»‘å®šï¼Œå°†ä» API Server å¤„åŒæ­¥åˆ°çš„å¯¹è±¡å˜æ›´äº‹ä»¶è½¬åŒ–ä¸ºæ§åˆ¶å™¨å¾ªç¯å½“ä¸­çš„ <code>reconcile.Request</code> å¯¹è±¡ã€‚</li>
</ul>
<h1 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h1><p><code>Source</code> é¡¾åæ€ä¹‰æ˜¯æ¥æºï¼Œä½†å‡†ç¡®æ¥è®²è¿™ä¸ªæ¥æºæ˜¯è¯·æ±‚çš„æ¥æºï¼Œä¹Ÿå°±æ˜¯åœ¨ kubebuilder ä¸­æ‰€æœ‰çš„æ§åˆ¶å™¨éœ€è¦å®ç°çš„ Reconcile æ–¹æ³•çš„ requests.Request è¿™ä¸€å‚æ•°çš„ç”Ÿäº§è€…ã€‚åœ¨ Source æœ‰ä¸‰ç§ç±»å‹ï¼ŒChannelï¼ŒInformer å’Œ Funcã€‚</p>
<p>å…¶ä¸­ <a href="https://github.com/kubernetes-sigs/controller-runtime/blob/7032a3cc91d2afc4c2d54e4a4891cf75da9f75f5/pkg/source/source.go#L67-L86">Channel</a> ç±»å‹ä¸»è¦ç”¨äºå¤–éƒ¨äº‹ä»¶çš„å¤„ç†ï¼Œä¾‹å¦‚ Github çš„ Webhookï¼Œéœ€è¦ç”¨æˆ·è‡ªè¡Œç¼–å†™å¤–éƒ¨çš„ Source æ¥å°†é€šç”¨äº‹ä»¶å†™å…¥åˆ°å†…éƒ¨çš„ Channel å½“ä¸­ã€‚</p>
<p>Informer ç±»å‹çš„ Source åœ¨æ§åˆ¶å™¨å½“ä¸­æœ€å¸¸ç”¨ï¼Œå®ƒå°è£…äº† client-go çš„ cache.Informer æ¥å£ï¼Œå°†äº‹ä»¶å¤„ç†å™¨ä¸ informer è¿›è¡Œç»‘å®šï¼Œç”¨äºäº§ç”Ÿæºäºé›†ç¾¤å†…éƒ¨çš„äº‹ä»¶ï¼Œä¾‹å¦‚ Pod çš„åˆ›å»ºç­‰ã€‚</p>
<figure class="highlight go"><figcaption><span>pkg/source.go:184-206</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Informer is used to provide a source of events originating inside the cluster from Watches (e.g. Pod Create).</span></span><br><span class="line"><span class="keyword">type</span> Informer <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// Informer is the controller-runtime Informer</span></span><br><span class="line">	Informer cache.Informer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _ Source = &amp;Informer&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start is internal and should be called only by the Controller to register an EventHandler with the Informer</span></span><br><span class="line"><span class="comment">// to enqueue reconcile.Requests.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(is *Informer)</span></span> Start(ctx context.Context, handler handler.EventHandler, queue workqueue.RateLimitingInterface,</span><br><span class="line">	prct ...predicate.Predicate) <span class="type">error</span> &#123;</span><br><span class="line">	<span class="comment">// Informer should have been specified by the user.</span></span><br><span class="line">	<span class="keyword">if</span> is.Informer == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;must specify Informer.Informer&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	_, err := is.Informer.AddEventHandler(internal.NewEventHandler(ctx, queue, handler, prct).HandlerFuncs())</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸º Source æ¥å£åªæœ‰ä¸€ä¸ª Start() æ–¹æ³•ï¼Œæ‰€ä»¥ Func ç±»å‹åªæ˜¯ä¸ºäº†æ–¹ä¾¿å°†å•ä¸ªå‡½æ•°å®ç°æˆä¸ºè¿™ä¸ªæ¥å£è€Œå°è£…å‡ºæ¥çš„ç±»å‹ï¼Œåœ¨æ­¤ä¸å†ä½œæ›´å¤šä»‹ç»ã€‚</p>
<p>åœ¨ Source çš„å†…éƒ¨å®ç° (<code>pkg/internal/source</code>) ä¸­ï¼Œå®ƒå°†ä» Informer ä¸­è·å–åˆ°çš„å¯¹è±¡è½¬æ¢ä¸º Createï¼ŒUpdateï¼ŒDelete å’Œ Generic å››ç±»äº‹ä»¶ï¼Œå››ç±»äº‹ä»¶åˆ†åˆ«ç”±ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œä¸‹ä¸€æ­¥çš„å¤„ç†ã€‚å…¶ä¸­ï¼Œäº‹ä»¶å¤„ç†å™¨åœ¨ Handler åŒ…ä¸­å®šä¹‰ï¼ŒInformer åœ¨ Cache åŒ…ä¸­å®šä¹‰ã€‚</p>
<h1 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h1><figure class="highlight go"><figcaption><span>pkg/handler.go:44-57</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> EventHandler <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// Create is called in response to a create event - e.g. Pod Creation.</span></span><br><span class="line">	Create(context.Context, event.CreateEvent, workqueue.RateLimitingInterface)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Update is called in response to an update event -  e.g. Pod Updated.</span></span><br><span class="line">	Update(context.Context, event.UpdateEvent, workqueue.RateLimitingInterface)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Delete is called in response to a delete event - e.g. Pod Deleted.</span></span><br><span class="line">	Delete(context.Context, event.DeleteEvent, workqueue.RateLimitingInterface)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Generic is called in response to an event of an unknown type or a synthetic event triggered as a cron or</span></span><br><span class="line">	<span class="comment">// external trigger request - e.g. reconcile Autoscaling, or a Webhook.</span></span><br><span class="line">	Generic(context.Context, event.GenericEvent, workqueue.RateLimitingInterface)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Source å°†äº‹ä»¶å¤„ç†å™¨ EventHandlers å’Œ Informers è¿›è¡Œç»‘å®šï¼ŒHandlers å°†æŸä¸ªæŸç±»å‹èµ„æº A çš„äº‹ä»¶ Event è½¬åŒ–ä¸ºæŸç±»å‹èµ„æº B çš„äº‹ä»¶è¯·æ±‚ Request æ¨å…¥å·¥ä½œé˜Ÿåˆ—ï¼ˆ<code>workqueue.RateLimitingInterface</code>ï¼Œå®šä¹‰åœ¨ client-go å½“ä¸­ï¼‰ï¼Œå…¶ä¸­ A é€šå¸¸ç­‰äº Bï¼Œä½†ä¹Ÿå­˜åœ¨ A ä¸ç­‰äº B çš„æƒ…å†µã€‚ä¸‹é¢å°†ä¸¤ç§æƒ…å†µåŒºåˆ†ä»‹ç»ã€‚</p>
<p><strong>1. A &#x3D;&#x3D; B</strong></p>
<p>A &#x3D;&#x3D; B ä¹Ÿå°±æ˜¯è¯´äº§ç”Ÿäº‹ä»¶çš„èµ„æºå’Œéœ€è¦è°ƒè§£çš„èµ„æºç±»å‹æ˜¯ç›¸åŒçš„ï¼Œä¾‹å¦‚ç”¨æˆ·æäº¤äº†ä¸€ä¸ª Podï¼Œé‚£ Pod çš„æ§åˆ¶å™¨å°±ä¼šæ¥æ”¶åˆ°è¿™ä¸ª Pod è¢«åˆ›å»ºçš„äº‹ä»¶ï¼Œå¹¶å¯¹è¯¥äº‹ä»¶è¿›è¡Œè°ƒè§£ã€‚è¿™æ˜¯æœ€æ™®éçš„æƒ…å†µï¼Œåœ¨ <code>pkg/handler/enqueue.go</code> ä¸­æœ‰è¯¥æƒ…å†µçš„å®ç°ã€‚</p>
<p><strong>2. A !&#x3D; B</strong></p>
<p>A !&#x3D; B è¯´æ˜åœ¨ç±»å‹ A äº§ç”Ÿçš„äº‹ä»¶è¦å‘é€ç»™ç±»å‹ B çš„æ§åˆ¶å™¨è¿›è¡Œè°ƒè§£ï¼Œè¿™åœ¨å•ä¸€èµ„æº&#x2F;æ§åˆ¶å™¨çš„è¯­å¢ƒä¸‹æ²¡æœ‰å¤ªå¤§çš„æ„ä¹‰ï¼Œä½†å¦‚æœå°†èµ„æºçš„ä»å±å…³ç³»ä¹Ÿçº³å…¥å…¶ä¸­å°±å¾ˆå¥½è§£é‡Šäº†ï¼šçˆ¶çº§èµ„æºåœ¨å­èµ„æºå‘ç”Ÿå˜æ›´æ—¶æ”¶åˆ°ç›¸åº”çš„äº‹ä»¶ï¼Œçº§è”åœ°è°ƒè§£è‡ªèº«çš„çŠ¶æ€ï¼Œè¿›è€ŒåŠ é€Ÿå¤šçº§èµ„æºç»“æ„æ•´ä½“çš„è°ƒè§£é€Ÿåº¦ã€‚ä¾‹å¦‚ ReplicaSet èµ„æºåº”è¯¥ç›‘å¬å…¶æ‹¥æœ‰çš„ Pod èµ„æºçš„äº‹ä»¶ï¼Œå½“ Pod çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒReplicaSet æ§åˆ¶å™¨ä¹Ÿåº”è¯¥è°ƒè§£ ReplicaSet èµ„æºçš„çŠ¶æ€æˆ–é…ç½®ï¼Œä»¥æ±‚ç¬¦åˆé¢„æœŸã€‚</p>
<p>åœ¨ <code>pkg/handler/enqueue_owner.go</code> å’Œ <code>enqueue_mapped.go</code> ä¸­æœ‰ A !&#x3D; B æ—¶çš„ handler æ–¹æ³•å®ç°ã€‚å…¶ä¸­ <code>enqueue_owner.go</code> ä¸­ä¸ºæˆ‘ä»¬å®ç°äº†â€œå­èµ„æºå˜æ›´ï¼Œçˆ¶èµ„æºè°ƒè§£â€çš„é€»è¾‘ï¼Œåœ¨ kubebuilder ä¸­åœ¨ builder æ–¹æ³•ä¸‹ä½¿ç”¨ <code>Owns()</code> æ–¹æ³•å¯ä»¥å£°æ˜ä»å±å…³ç³»ï¼Œä»è€Œè®©æˆ‘ä»¬çš„æ§åˆ¶å™¨èƒ½å¤Ÿè°ƒè§£æ‹¥æœ‰çš„å…¶ä»–èµ„æºçš„â€œæ­¤ç±»èµ„æºâ€ã€‚</p>
<p>è€Œ <code>enqueue_mapped.go</code> åˆ™å°è£…äº†æ›´ä¸ºé€šç”¨çš„äº‹ä»¶å¤„ç†å™¨æ–¹æ³•ï¼Œèƒ½å¤Ÿè®©ç”¨æˆ·è‡ªå®šä¹‰ä» client.Object åˆ° reconcile.Request çš„æ˜ å°„ï¼Œå®ç°æ›´ä¸ºçµæ´»çš„äº‹ä»¶å…¥é˜Ÿé€»è¾‘ã€‚</p>
<h1 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h1><p>Controller æ§åˆ¶å™¨æ˜¯æˆ‘ä»¬è¦è¡¥å……ç¼–ç å¹¶æœ€ç»ˆè¿è¡Œçš„è‹¥å¹²å®ä½“ï¼Œå®ƒä»¬è´Ÿè´£ä» K8s çš„æ§åˆ¶å¾ªç¯ä¸­å–å›å¯¹åº”èµ„æºçš„äº‹ä»¶ï¼Œå¹¶ä¸”è°ƒç”¨è‡ªèº«çš„è°ƒè§£å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ç¼–å†™ Operator æ—¶è¡¥å……çš„ Reconcile å‡½æ•°ï¼‰å®Œæˆèµ„æºçŠ¶æ€å¯¹é½çš„ä»»åŠ¡ã€‚å¦‚å¼€å¤´çš„æ€ç»´å¯¼å›¾æ‰€ç¤ºï¼Œæˆ‘åˆ—å‡ºäº† <code>Reconcile</code>ï¼Œ<code>Workqueue</code>ï¼Œ<code>Watches()</code> å’Œ <code>Metadata Projection</code> è¿™äº›å­é¡¹ç›®ï¼Œä¸‹é¢åˆ†åˆ«å°±è¿™äº›å†…å®¹è¿›è¡Œä»‹ç»ã€‚</p>
<figure class="highlight go"><figcaption><span>pkg/internal/controller/controller.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Controller <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// Name is used to uniquely identify a Controller in tracing, logging and monitoring.  Name is required.</span></span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// MaxConcurrentReconciles is the maximum number of concurrent Reconciles which can be run. Defaults to 1.</span></span><br><span class="line">	MaxConcurrentReconciles <span class="type">int</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Reconciler is a function that can be called at any time with the Name / Namespace of an object and</span></span><br><span class="line">	<span class="comment">// ensures that the state of the system matches the state specified in the object.</span></span><br><span class="line">	<span class="comment">// Defaults to the DefaultReconcileFunc.</span></span><br><span class="line">	Do reconcile.Reconciler</span><br><span class="line"></span><br><span class="line">	<span class="comment">// MakeQueue constructs the queue for this controller once the controller is ready to start.</span></span><br><span class="line">	<span class="comment">// This exists because the standard Kubernetes workqueues start themselves immediately, which</span></span><br><span class="line">	<span class="comment">// leads to goroutine leaks if something calls controller.New repeatedly.</span></span><br><span class="line">	MakeQueue <span class="function"><span class="keyword">func</span><span class="params">()</span></span> workqueue.RateLimitingInterface</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Queue is an listeningQueue that listens for events from Informers and adds object keys to</span></span><br><span class="line">	<span class="comment">// the Queue for processing</span></span><br><span class="line">	Queue workqueue.RateLimitingInterface</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Reconcile"><a href="#Reconcile" class="headerlink" title="Reconcile"></a>Reconcile</h2><p>Reconcile å‡½æ•°ä¹Ÿå°±æ˜¯<a href="https://github.com/kubernetes-sigs/controller-runtime/blob/7032a3cc91d2afc4c2d54e4a4891cf75da9f75f5/pkg/internal/controller/controller.go#L41">æ§åˆ¶å™¨ç»“æ„ä½“ï¼ˆpkg&#x2F;internal&#x2F;controllerï¼‰</a>å½“ä¸­ <code>Do</code> è¿™ä¸ªå­—æ®µçš„å…·ä½“å®ç°ï¼Œå®ƒæ¥æ”¶ <code>reconcile.Request</code> è¿”å› <code>reconcile.Result</code>ï¼Œè¿™ä¸¤ä¸ªå‚æ•°ç±»å‹éƒ½æä¸ºç®€å•ï¼Œä»ä¸­å¯ä»¥è¡¨ç°å‡º controller-runtime çš„è®¾è®¡è€…ä»¬å¸Œæœ›æŠŠæœ€ç®€å•çš„æ¥å£ç•™ç»™å¼€å‘è€…ã€‚reconcile.Request å…¶å®å°±æ˜¯ <code>NamespacedName</code>ï¼Œreconcile.Result åˆ™åŒ…å«äº†ä¸¤ä¸ªå­—æ®µ <code>Requeue</code> å’Œ <code>RequeueAfter</code>ï¼Œåˆ†åˆ«è¡¨ç¤ºæ˜¯å¦é‡æ–°å…¥é˜Ÿå’Œå¤šä¹…åé‡æ–°å…¥é˜Ÿã€‚è¿™ä¸åç»­çš„å·¥ä½œé˜Ÿåˆ—æ¨¡å—ç›¸äº’é…åˆï¼Œæ”¯æŒæˆ‘ä»¬å®ç°æœ‰è®¡åˆ’ã€æœ‰è§„å¾‹çš„è°ƒè§£é‡è¯•ã€‚</p>
<h2 id="Workqueue"><a href="#Workqueue" class="headerlink" title="Workqueue"></a>Workqueue</h2><p>Workqueue é¡¾åæ€ä¹‰æ˜¯å·¥ä½œé˜Ÿåˆ—ï¼Œä¸ Controller æ§åˆ¶å™¨å’Œ Source äº‹ä»¶æºç›¸äº’é…åˆï¼Œå®Œæˆå¯¹èµ„æºå˜æ›´äº‹ä»¶çš„æœ‰åºå¤„ç†è¿‡ç¨‹ã€‚workqueue æ˜¯ client-go ä¸­çš„ <code>workqueue.RateLimitingInterface</code> æ¥å£ï¼Œä¹Ÿå°±æ˜¯é€Ÿç‡å—é™çš„å·¥ä½œé˜Ÿåˆ—ï¼Œé™å®šé€Ÿç‡çš„å·¥ä½œç”± <code>rateLimiter</code> æ¥å£å®Œæˆï¼Œä¸€ä¸ªå¯¹è±¡éœ€è¦å…ˆç»è¿‡ rateLimiter åŒæ„æ‰èƒ½å¤Ÿé¡ºåˆ©å…¥é˜Ÿï¼Œé€Ÿç‡é™å®šå™¨çš„é€»è¾‘å¯ç”±ç”¨æˆ·è‡ªè¡Œå®šä¹‰ï¼Œä½†å¤§éƒ¨åˆ† K8s å®¢æˆ·ç«¯çš„åœºæ™¯å½“ä¸­ï¼Œä½¿ç”¨é»˜è®¤çš„é€Ÿç‡é™å®šé€»è¾‘å³å¯ã€‚é€Ÿç‡å—é™çš„å·¥ä½œé˜Ÿåˆ—ä¹Ÿåœ¨ client-go ä¸­å®Œæˆå®šä¹‰ï¼Œä¹‹åçš„æ–‡ç« ä¸­æœ‰æœºä¼šå†æ¢è®¨ã€‚</p>
<h2 id="Watches"><a href="#Watches" class="headerlink" title="Watches"></a>Watches</h2><p>Watches æ–¹æ³•å°†æŸä¸€ç±»å¯¹è±¡åŒ…è£…æˆä¸º Sourceï¼Œå¹¶å°†å…¶é€šè¿‡äº‹ä»¶å¤„ç†å™¨ Handler ä¸å·¥ä½œé˜Ÿåˆ—è¿›è¡Œå…³è”ã€‚åœ¨ Kubebuilder å½“ä¸­æˆ‘ä»¬ç›´æ¥ä½¿ç”¨çš„æ–¹æ³•æ˜¯ <code>ControllerManagedBy</code>ï¼Œå®ƒé‡‡ç”¨æ„å»ºè€…æ¨¡å¼è¿”å›ä¸€ä¸ª <code>Builder</code> ç±»å‹çš„ç»“æ„ï¼Œæ”¯æŒæˆ‘ä»¬é“¾å¼è°ƒç”¨é…ç½®æ–¹æ³•ï¼Œæœ€ç»ˆé€šè¿‡ <code>Complete</code> æ–¹æ³•å®Œæˆæ§åˆ¶å™¨çš„æ„å»ºã€‚åœ¨ Builder ç»“æ„ä½“ä¸‹æš´éœ²äº†è‹¥å¹²çš„æ–¹æ³•ï¼Œå…¶ä¸­æœ‰ Forï¼ŒOwns å’Œ Watches è¿™ä¸‰ä¸ªæ–¹æ³•ç”¨äºç»‘å®š Source å’Œ Handlerã€‚For å’Œ Owns å…¶å®æ˜¯ Watches çš„è¯­æ³•ç³–ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºç›‘å¬æŸç±»èµ„æºå’Œç›‘å¬æ‹¥æœ‰çš„æŸç±»èµ„æºï¼ˆä»å±å…³ç³»é€šè¿‡ OwnerReferences æ„å»ºï¼‰ï¼Œéƒ½å¯ä»¥é€šè¿‡ Watches æ–¹æ³•æ¥å®ç°ã€‚</p>
<p>Watches æ–¹æ³•æ¥å— <code>client.Object</code>ï¼Œ<code>handler.EventHandler</code> å’Œ <code>WatchesOption</code> ä½œä¸ºå‚æ•°ï¼Œä»é›†ç¾¤çš„ç¼“å­˜ä¸­æ‹¿åˆ°æŸç±»èµ„æºçš„ Informer å°è£…ä¸º Sourceï¼Œç»‘å®šä¸Šäº‹ä»¶å¤„ç†å™¨ã€‚handler åŒ…ä¸­æä¾›çš„ä¸¤ä¸ªç°æœ‰çš„æ–¹æ³•åˆ†åˆ«æ„æˆäº† For å’Œ Owns ä¸¤ä¸ªæ–¹æ³•å¯¹ Watches å°è£…çš„è¯­æ³•ç³–ã€‚</p>
<p>Watches çš„è¡Œä¸ºè¿˜ä¼šæ”¶åˆ° Predicates çš„å½±å“ï¼ŒPredicates èµ·è¿‡æ»¤ä½œç”¨ï¼Œç”¨æ¥å†³å®šä»€ä¹ˆäº‹ä»¶åº”è¯¥è¿›å…¥å·¥ä½œé˜Ÿåˆ—ï¼Œä»€ä¹ˆäº‹ä»¶ä¸åº”è¯¥è¿›å…¥å·¥ä½œé˜Ÿåˆ—ã€‚åˆšå¼€å§‹æ¥è§¦ Controller runtime æ—¶è®¸å¤šå¼€å‘è€…ç»å¸¸ä¼šé‡åˆ°èµ„æº Spec å˜æ›´åè§¦å‘è°ƒè§£ï¼Œæ§åˆ¶å™¨æ›´æ–°èµ„æº Status ä¹‹åå†æ¬¡è§¦å‘è°ƒè§£çš„è«åå…¶å¦™çš„æ­»å¾ªç¯ï¼Œè¿™ä¸ªæƒ…å†µå°±æ˜¯ Predicate æ²¡æœ‰æ­£ç¡®è®¾ç½®ï¼Œå½“èµ„æºï¼ˆåŒ…æ‹¬ Statusï¼‰å‘ç”Ÿæ›´æ–°åï¼Œèµ„æºçš„ ResourceVersion ä¼šå‘ç”Ÿå˜æ›´ï¼Œä½†å¦‚æœä¸å¸Œæœ› Status æ›´æ–°åè§¦å‘è°ƒè§£ï¼Œå¯ä»¥åœ¨ <code>builder.WithEventFilter()</code> ä¸­ä¼ å…¥é¢„å…ˆå®šä¹‰å¥½çš„ <code>predicate.GenerationChangedPredicate&#123;&#125;</code>ï¼Œè¿™æ ·ä¼šè¿‡æ»¤æ‰ ResourceVersion å‘ç”Ÿå˜æ›´çš„äº‹ä»¶ã€‚</p>
<h2 id="Metadata-Projection"><a href="#Metadata-Projection" class="headerlink" title="Metadata Projection"></a>Metadata Projection</h2><p>åœ¨ Controller Builder åŒ…ä¸­æœ‰ä¸ªç±»å‹æ˜¯ <code>objectProjection</code> è¡¨ç¤ºå¯¹è±¡çš„æŠ•å½±ã€‚åœ¨è°ƒç”¨ Forï¼ŒOwns å’Œ Watches ä¸‰ä¸ªæ–¹æ³•æ—¶å¯ä»¥é€šè¿‡æœ«å°¾çš„ä¸å®šé•¿é€‰é¡¹å‚æ•°ä¼ å…¥æœ‰å…³æŠ•å½±çš„é…ç½®ï¼Œbuilder.OnlyMetadata å°±æ˜¯è¿™æ ·çš„é…ç½®ã€‚OnlyMetadata ç”¨æ¥å‘Šè¯‰æ§åˆ¶å™¨åªéœ€è¦ç¼“å­˜å…ƒä¿¡æ¯ï¼Œå¹¶ä¸”åªé€šè¿‡ MetadataClient Watch å…ƒä¿¡æ¯æ ¼å¼çš„èµ„æºå¯¹è±¡ã€‚è¿™å¯¹äºæŸç±»èµ„æºå¯¹è±¡ä¼—å¤šã€èµ„æºå æ®ç©ºé—´æå¤§æˆ–è€…åªçŸ¥é“èµ„æºçš„ GVK ä¸çŸ¥é“èµ„æºçš„å…·ä½“ç»“æ„ç­‰æƒ…å†µæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>
<h1 id="Controller-Manager"><a href="#Controller-Manager" class="headerlink" title="Controller Manager"></a>Controller Manager</h1><p>Controller Manager æ§åˆ¶å™¨ç®¡ç†å™¨ç®¡ç†äº†åŒ…æ‹¬æ§åˆ¶å™¨åœ¨å†…çš„è‹¥å¹²å¯è¿è¡Œæ¥å£ï¼ˆRunnableï¼‰ï¼Œåªè¦å®ç°äº†æ–¹æ³• <code>Start(context.Context) error</code> å°±èƒ½å¤Ÿæˆä¸º Runnableï¼Œä¸Šè¿°ä»‹ç»çš„è‹¥å¹²æ¨¡å—éƒ½å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚ Cache, Source, Controllerï¼Œè¿˜æœ‰æœªæåŠçš„ Webhookï¼ŒHttpServerï¼ŒLeaderElection ç­‰ã€‚ç®¡ç†å™¨è‡ªèº«ä¹Ÿå®ç°äº† Start æ–¹æ³•ï¼Œç”¨äºåœ¨æˆ‘ä»¬çš„ä¸»ç¨‹åºä¸­è°ƒç”¨è¿è¡Œã€‚ä¸Šè¿°æ‰€æœ‰æ¨¡å—çš„é…ç½®ä¹Ÿéƒ½å¯ä»¥é€šè¿‡ Manager çš„é…ç½®è¿›è¡Œä¼ å…¥ï¼Œæ¢å¥è¯è¯´ï¼ŒManager çš„é…ç½®æ•´åˆäº†æ‰€æœ‰å…¶ä»–æ¨¡å—çš„é…ç½®ä¿¡æ¯ã€‚</p>
<p>Manager è¿˜å°è£…äº† Cluster è¿™ä¸ªæ¥å£ï¼Œcluster åŒ…å«äº† <code>rest.Config</code>, <code>runtime.Scheme</code>, <code>Cache</code>, <code>client.Reader</code> å’Œ <code>meta.RESTMapper</code> ç­‰åŒ…å«é›†ç¾¤ä¿¡æ¯çš„é‡è¦å­—æ®µï¼ŒCluster æ¥å£æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯åªè¯»çš„ï¼Œä¹Ÿç¡®å®šäº†è¯¥ç»“æ„å°±æ˜¯å•çº¯ç”¨äºâ€œä¿¡æ¯æŸ¥é˜…â€çš„ã€‚</p>
<h1 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h1><p>Client å°è£…äº†å¸¸ç”¨çš„å®¢æˆ·ç«¯åŠŸèƒ½ï¼ŒGet å’Œ List æ“ä½œä¼˜å…ˆä»ç¼“å­˜ä¸­è¯»å–ï¼ŒCreateï¼ŒUpdate å’Œ Delete ç­‰å†™å…¥æ“ä½œç›´æ¥ä¸ API Server è¿›è¡Œé€šä¿¡ã€‚å½“ç„¶å¯ä»¥åœ¨åˆå§‹åŒ–å®¢æˆ·ç«¯æ—¶é€šè¿‡ <code>client.Options.Cache.DisableFor</code> å­—æ®µé…ç½®ç¦ç”¨æŸäº›èµ„æºç±»å‹çš„ç¼“å­˜ï¼Œç›´æ¥ä» API Server è¯»å–ã€‚</p>
<h1 id="å¯å‘"><a href="#å¯å‘" class="headerlink" title="å¯å‘"></a>å¯å‘</h1><h2 id="å¯¹å¤–çš„-API-ä¿æŒç®€å•"><a href="#å¯¹å¤–çš„-API-ä¿æŒç®€å•" class="headerlink" title="å¯¹å¤–çš„ API ä¿æŒç®€å•"></a>å¯¹å¤–çš„ API ä¿æŒç®€å•</h2><p>å¦‚æœä¸è¯»æºç ï¼Œä¸ä»”ç»†è¯»æ–‡æ¡£ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ¥è§¦åˆ°çš„æ¥å£æ— éå°±æ˜¯ Controller Builder çš„ä½¿ç”¨å’Œ Reconcile æ–¹æ³•ï¼Œäº†è§£ K8s çš„æ§åˆ¶å¾ªç¯é€»è¾‘å°±å¯ä»¥å¼€å§‹ç¼–å†™ Operator çš„ä»£ç ã€‚Controller-runtime é«˜å†…èšçš„ç‰¹ç‚¹å°†ç®€å•ç•™ç»™äº†å¼€å‘è€…ï¼Œå¤æ‚æ€§ç”±è®¾è®¡è€…å’Œç»´æŠ¤è€…æ‰¿æ‹…ã€‚</p>
<p>åŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°ä¸ºäº†ä¿æŒä¾èµ–çš„ç®€æ´ï¼ŒController-runtime ä»å…¶ä»–åœ°æ–¹(k8s.io&#x2F;kubernetes)å¤åˆ¶äº†ä¸€äº›æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œä»è€Œ<a href="https://github.com/kubernetes-sigs/controller-runtime/blob/7032a3cc91d2afc4c2d54e4a4891cf75da9f75f5/pkg/internal/flock/doc.go#L17-L21">é¿å…äº†ç›´æ¥ä¾èµ–æ•´ä¸ªåŒ…</a>ã€‚è™½ç„¶ä¸ä¼˜é›…ï¼Œä½†ä¸å¾—ä¸è¯´å®ç”¨ä¸»ä¹‰åœ¨è¿™é‡Œå†æ¬¡èµ¢å¾—äº†èƒœåˆ©ã€‚</p>
<h2 id="å¤šåˆ©ç”¨ç¼–è¯‘é˜¶æ®µçš„é™æ€æ£€æŸ¥"><a href="#å¤šåˆ©ç”¨ç¼–è¯‘é˜¶æ®µçš„é™æ€æ£€æŸ¥" class="headerlink" title="å¤šåˆ©ç”¨ç¼–è¯‘é˜¶æ®µçš„é™æ€æ£€æŸ¥"></a>å¤šåˆ©ç”¨ç¼–è¯‘é˜¶æ®µçš„é™æ€æ£€æŸ¥</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Source <span class="keyword">interface</span> &#123;</span><br><span class="line">  <span class="comment">// Some methods</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> kind <span class="keyword">struct</span> &#123;</span><br><span class="line">  <span class="comment">// Some fields</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _ Source = kind&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç æ®µå®šä¹‰äº†ä¸€ä¸ªå…¬å¼€æ¥å£å’Œä¸€ä¸ªå†…éƒ¨ç»“æ„ï¼Œé€šè¿‡ <code>var _ Source = kind&#123;&#125;</code> è¿™ä¸ªè¯­å¥åœ¨ç¼–è¯‘é˜¶æ®µä¿éšœæˆ‘ä»¬çš„ç»“æ„å®ç°äº†æŒ‡å®šçš„æ¥å£ï¼Œè€Œå› ä¸ºå˜é‡åä¸ºç©ºï¼Œåœ¨ç¼–è¯‘å®Œæˆåè¯¥å˜é‡ä¼šè¢«æŠ›å¼ƒï¼Œå¯¹ç¨‹åºçš„è¿è¡ŒçŠ¶æ€æ²¡æœ‰å½±å“ã€‚è¿™ä¸ªå°æŠ€å·§å¯ä»¥åœ¨ä¹‹åçš„å¼€å‘ä¸­å¤šåŠ ä½¿ç”¨ï¼Œå°½æ—©é¿å…å¯èƒ½å‡ºç°çš„<code>æœªå®Œå…¨å®ç°æŸæ¥å£</code>å¯¼è‡´çš„è¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<h2 id="Option-æ¥å£"><a href="#Option-æ¥å£" class="headerlink" title="Option æ¥å£"></a>Option æ¥å£</h2><p>åœ¨ Controller runtime ä¸­å¹¿æ³›å‡ºç° Option æ¥å£çš„å®ç°ï¼Œå„ç§é…ç½®éƒ½é€šè¿‡ä¼ é€’ Option æ¥å£æ¥å®Œæˆï¼Œä¸‹é¢æ˜¯å…¶ä¸­ä¸€å¤„æºç ç‰‡æ®µï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ForOption <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// ApplyToFor applies this configuration to the given for input.</span></span><br><span class="line">	ApplyToFor(*ForInput)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Predicates <span class="keyword">struct</span> &#123;</span><br><span class="line">	predicates []predicate.Predicate</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ApplyToFor applies this configuration to the given ForInput options.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w Predicates)</span></span> ApplyToFor(opts *ForInput) &#123;</span><br><span class="line">	opts.predicates = w.predicates</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(blder *Builder)</span></span> For(object client.Object, opts ...ForOption) *Builder &#123;</span><br><span class="line">	<span class="keyword">if</span> blder.forInput.object != <span class="literal">nil</span> &#123;</span><br><span class="line">		blder.forInput.err = fmt.Errorf(<span class="string">&quot;For(...) should only be called once, could not assign multiple objects for reconciliation&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span> blder</span><br><span class="line">	&#125;</span><br><span class="line">	input := ForInput&#123;object: object&#125;</span><br><span class="line">	<span class="keyword">for</span> _, opt := <span class="keyword">range</span> opts &#123;</span><br><span class="line">		opt.ApplyToFor(&amp;input)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	blder.forInput = input</span><br><span class="line">	<span class="keyword">return</span> blder</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬ä¸ºå¤šä¸ªç±»å‹å®ç°äº† Option æ¥å£çš„æ–¹æ³•ï¼Œè¿™æ ·å¤šä¸ªç±»å‹å¯ä»¥ä½œä¸ºç›¸åŒçš„ç±»å‹ä¼ é€’ç»™åŒä¸€ä¸ªå‡½æ•°ï¼Œä¾‹å¦‚ For å½“ä¸­çš„ Predicate å’Œ ObjectProjection ç­‰ã€‚é€šè¿‡ Option æ¥å£å¯ä»¥è·å¾—æ›´é«˜çš„é…ç½®çµæ´»æ€§ã€‚</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Controller-runtime æºç é˜…è¯»</p><p><a href="https://powerfooi.github.io/2024/02/03/ReadSourceOfControllerRuntime/">https://powerfooi.github.io/2024/02/03/ReadSourceOfControllerRuntime/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>ä½œè€…</h6><p>PowerfooI</p></div></div><div class="level-item is-narrow"><div><h6>å‘å¸ƒäº</h6><p>2024-02-03</p></div></div><div class="level-item is-narrow"><div><h6>æ›´æ–°äº</h6><p>2024-08-04</p></div></div><div class="level-item is-narrow"><div><h6>è®¸å¯åè®®</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Reading/">Reading</a><a class="link-muted mr-2" rel="tag" href="/tags/CloudNative/">CloudNative</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=660fc46b8643100019977f2b&amp;product=inline-share-buttons&amp;source=platform" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2024/02/27/YetAnotherImporter-VSCode/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">VSCode æ’ä»¶ - YAI</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2024/01/13/WhatHappensWhenK8s/"><span class="level-item">å½“æˆ‘æ‰§è¡Œ kubectl create æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ[è¯‘]</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">è¯„è®º</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "ab90cd363d53069647ecadf6baac7068",
            repo: "powerfooI.github.io",
            owner: "powerfooI",
            clientID: "de634a427346094182ce",
            clientSecret: "977edb8eca9693667f47bdbb9ab33c9739f1c494",
            admin: ["powerfooI"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            language: "zh-CN",
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/logo.png" alt="PowerfooI"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">PowerfooI</p><p class="is-size-6 is-block">ç å†œï¼ŒåŠªåŠ›æˆä¸ºè½¯ä»¶å·¥ç¨‹å¸ˆ</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>æµ™æ±Ÿæ­å·</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">32</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">34</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/PowerfooI" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">ç›®å½•</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Summary"><span class="level-left"><span class="level-item">1</span><span class="level-item">Summary</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#MindMap"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">MindMap</span></span></a></li><li><a class="level is-mobile" href="#WorkFlow"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">WorkFlow</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Cache"><span class="level-left"><span class="level-item">2</span><span class="level-item">Cache</span></span></a></li><li><a class="level is-mobile" href="#Source"><span class="level-left"><span class="level-item">3</span><span class="level-item">Source</span></span></a></li><li><a class="level is-mobile" href="#Handler"><span class="level-left"><span class="level-item">4</span><span class="level-item">Handler</span></span></a></li><li><a class="level is-mobile" href="#Controller"><span class="level-left"><span class="level-item">5</span><span class="level-item">Controller</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Reconcile"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">Reconcile</span></span></a></li><li><a class="level is-mobile" href="#Workqueue"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">Workqueue</span></span></a></li><li><a class="level is-mobile" href="#Watches"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">Watches</span></span></a></li><li><a class="level is-mobile" href="#Metadata-Projection"><span class="level-left"><span class="level-item">5.4</span><span class="level-item">Metadata Projection</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Controller-Manager"><span class="level-left"><span class="level-item">6</span><span class="level-item">Controller Manager</span></span></a></li><li><a class="level is-mobile" href="#Client"><span class="level-left"><span class="level-item">7</span><span class="level-item">Client</span></span></a></li><li><a class="level is-mobile" href="#å¯å‘"><span class="level-left"><span class="level-item">8</span><span class="level-item">å¯å‘</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#å¯¹å¤–çš„-API-ä¿æŒç®€å•"><span class="level-left"><span class="level-item">8.1</span><span class="level-item">å¯¹å¤–çš„ API ä¿æŒç®€å•</span></span></a></li><li><a class="level is-mobile" href="#å¤šåˆ©ç”¨ç¼–è¯‘é˜¶æ®µçš„é™æ€æ£€æŸ¥"><span class="level-left"><span class="level-item">8.2</span><span class="level-item">å¤šåˆ©ç”¨ç¼–è¯‘é˜¶æ®µçš„é™æ€æ£€æŸ¥</span></span></a></li><li><a class="level is-mobile" href="#Option-æ¥å£"><span class="level-left"><span class="level-item">8.3</span><span class="level-item">Option æ¥å£</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">åˆ†ç±»</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">å­¦ä¹ </span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%9A%8F%E7%AC%94/"><span class="level-start"><span class="level-item">éšç¬”</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-04T15:20:06.000Z">2024-12-04</time></p><p class="title"><a href="/2024/12/04/WriteCodeWithCursor/">ç”¨ Cursor å¿«é€Ÿæ­å»ºè½¯ä»¶åŸå‹</a></p><p class="categories"><a href="/categories/%E5%AD%A6%E4%B9%A0/">å­¦ä¹ </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-10-27T12:24:12.000Z">2024-10-27</time></p><p class="title"><a href="/2024/10/27/GoodByeBeijing/">å†è§åŒ—äº¬ ğŸ‘‹</a></p><p class="categories"><a href="/categories/%E9%9A%8F%E7%AC%94/">éšç¬”</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-09-12T14:55:54.000Z">2024-09-12</time></p><p class="title"><a href="/2024/09/12/BlackMythWukong/">è®°é»‘ç¥è¯æ‚Ÿç©ºäº‘é€šå…³â˜ï¸</a></p><p class="categories"><a href="/categories/%E9%9A%8F%E7%AC%94/">éšç¬”</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-27T15:52:22.000Z">2024-07-27</time></p><p class="title"><a href="/2024/07/27/TypeGymnastics/">ä¸€èµ·æ¥åšç±»å‹ä½“æ“å§ï¼ğŸ˜Š</a></p><p class="categories"><a href="/categories/%E5%AD%A6%E4%B9%A0/">å­¦ä¹ </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-06-22T15:48:27.000Z">2024-06-22</time></p><p class="title"><a href="/2024/06/22/RFTP-2/">rFTP - ç”¨ Rust å®ç°ç®€å•çš„ FTP Server (2)</a></p><p class="categories"><a href="/categories/%E5%AD%A6%E4%B9%A0/">å­¦ä¹ </a></p></div></article></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">æ ‡ç­¾</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AccessControl/"><span class="tag">AccessControl</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CI-CD/"><span class="tag">CI/CD</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CloudNative/"><span class="tag">CloudNative</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Coding/"><span class="tag">Coding</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Deployment/"><span class="tag">Deployment</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docs/"><span class="tag">Docs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ECMAScript/"><span class="tag">ECMAScript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GC/"><span class="tag">GC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go/"><span class="tag">Go</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GraphQL/"><span class="tag">GraphQL</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Lint/"><span class="tag">Lint</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NPM/"><span class="tag">NPM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Network/"><span class="tag">Network</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/React/"><span class="tag">React</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reading/"><span class="tag">Reading</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Rust/"><span class="tag">Rust</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Security/"><span class="tag">Security</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tools/"><span class="tag">Tools</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript/"><span class="tag">TypeScript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VSCode/"><span class="tag">VSCode</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vue/"><span class="tag">Vue</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Web-Server/"><span class="tag">Web Server</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%91%E6%B8%B8%E6%88%8F/"><span class="tag">äº‘æ¸¸æˆ</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%89%8D%E7%AB%AF/"><span class="tag">å‰ç«¯</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"><span class="tag">å°ç¨‹åº</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7/"><span class="tag">å·¥å…·</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%91%84%E5%BD%B1/"><span class="tag">æ‘„å½±</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%88%E7%8E%87/"><span class="tag">æ•ˆç‡</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B8%B8%E6%88%8F/"><span class="tag">æ¸¸æˆ</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B8%B8%E8%AE%B0/"><span class="tag">æ¸¸è®°</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BC%96%E7%A8%8B/"><span class="tag">ç¼–ç¨‹</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%83%A1%E6%80%9D%E4%B9%B1%E6%83%B3/"><span class="tag">èƒ¡æ€ä¹±æƒ³</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AF%BB%E5%90%8E%E6%84%9F/"><span class="tag">è¯»åæ„Ÿ</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Somewhere - PowerfooI&#039;s Zone</a><p class="is-size-7"><span>&copy; 2024 PowerfooI</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Visit GitHub Profile" href="https://github.com/powerfooi/"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>